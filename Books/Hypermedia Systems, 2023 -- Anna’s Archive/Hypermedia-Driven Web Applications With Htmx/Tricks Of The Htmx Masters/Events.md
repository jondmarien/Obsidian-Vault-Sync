# Events

Thus far we have worked with JavaScript events in htmx primarily via the `hx-trigger` attribute. This attribute has proven to be a powerful mechanism for driving our application using a declarative, HTML-friendly syntax.

However, there is much more we can do with events. Events play a crucial role both in the extension of HTML as a hypermedia, and, as we’ll see, in hypermedia-friendly scripting. Events are the “glue” that brings the DOM, HTML, htmx and scripting together. You might think of the DOM as a sophisticated “event bus” for applications.

We can’t emphasize enough: to build advanced Hypermedia-Driven Applications, it is worth the effort to learn about events [in depth](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events).

## Htmx-Generated Events

In addition to making it easy to _respond_ to events, htmx also _emits_ many useful events. You can use these events to add more functionality to your application, either via htmx itself, or by way of scripting.

Here are some of the most commonly used events triggered by htmx:

`htmx:load`

Triggered when new content is loaded into the DOM by htmx.

`htmx:configRequest`

Triggered before a request is issued, allowing you to programmatically configure the request or cancel it entirely.

`htmx:afterRequest`

Triggered after a request has responded.

`htmx:abort`

A custom event that can be sent to an htmx-powered element to abort an open request.

## Using the htmx:configRequest Event

Let’s look at an example of how to work with htmx-emitted events. We’ll use the `htmx:configRequest` event to configure an HTTP request.

Consider the following scenario: your server-side team has decided that they want you to include a server-generated token for extra security on every request. The token is going to be stored in `localStorage` in the browser, in the slot `special-token`.

The token is being set via some JavaScript (don’t worry about the details yet) when the user first logs in:

    let response = await fetch("/token"); <1>
    localStorage['special-token'] = await response.text();

Getting The Token in JavaScript

1.  Get the value of the token then set it into localStorage
    

The server-side team wants you to include this special token on every request made by htmx, as the `X-SPECIAL-TOKEN` header. How could you achieve this? One way would be to catch the `htmx:configRequest` event and update the `detail.headers` object with this token from `localStorage`.

In VanillaJS, it would look something like this, placed in a `</code> tag in the <code><head></code> of our HTML document:</p> <figure> <div class="sourceCode" id="cb112"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"htmx:configRequest"</span><span class="op">,</span> configEvent <span class="kw">=></span> {</span> <span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a> configEvent<span class="op">.</span><span class="at">detail</span><span class="op">.</span><span class="at">headers</span>[<span class="st">'X-SPECIAL-TOKEN'</span>] <span class="op">=</span> <span class="op"><</span><span class="dv">1</span><span class="op">></span></span> <span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a> localStorage[<span class="st">'special-token'</span>]<span class="op">;</span></span> <span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div> <figcaption><p>Adding the <code>X-SPECIAL-TOKEN</code> header</p></figcaption> </figure> <ol> <li><p>Retrieve the value from local storage and set it into a header.</p></li> </ol> <p>As you can see, we add a new value to the <code>headers</code> property of the event’s detail property. After the event handler executes, this <code>headers</code> property is read by htmx and used to construct the request headers for the AJAX request it makes.</p> <p>The <code>detail</code> property of the <code>htmx:configRequest</code> event contains a slew of useful properties that you can update to change the “shape” of the request, including:</p> <dl> <dt><code>detail.parameters</code></dt> <dd> <p>Allows you to add or remove request parameters</p> </dd> <dt><code>detail.target</code></dt> <dd> <p>Allows you to update the target of the request</p> </dd> <dt><code>detail.verb</code></dt> <dd> <p>Allows you to update HTTP “verb” of the request (e.g. <code>GET</code>)</p> </dd> </dl> <p>So, for example, if the server-side team decided they wanted the token included as a parameter, rather than as a request header, you could update your code to look like this:</p> <figure> <div class="sourceCode" id="cb113"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"htmx:configRequest"</span><span class="op">,</span> configEvent <span class="kw">=></span> {</span> <span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a> configEvent<span class="op">.</span><span class="at">detail</span><span class="op">.</span><span class="at">parameters</span>[<span class="st">'token'</span>] <span class="op">=</span> <span class="op"><</span><span class="dv">1</span><span class="op">></span></span> <span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a> localStorage[<span class="st">'special-token'</span>]<span class="op">;</span></span> <span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div> <figcaption><p>Adding the <code>token</code> parameter</p></figcaption> </figure> <ol> <li><p>Retrieve the value from local storage and set it into a parameter.</p></li> </ol> <p>As you can see, this gives you a lot of flexibility in updating the AJAX request that htmx makes.</p> <p>The full documentation for the <code>htmx:configRequest</code> event (and other events you might be interested in) can be found <a href="https://htmx.org/events/#htmx:configRequest">on the htmx website</a>.</p> </section> <section id="canceling-a-request-using-htmxabort" class="level4"> <h4>Canceling a Request Using htmx:abort</h4> <p>We can listen for any of the many useful events from htmx, and we can respond to those events using <code>hx-trigger</code>. What else can we do with events?</p> <p>It turns out that htmx itself listens for one special event, <code>htmx:abort</code>. When htmx receives this event on an element that has a request in flight, it will abort the request.</p> <p>Consider a situation where we have a potentially long-running request to <code>/contacts</code>, and we want to offer a way for the users to cancel the request. What we want is a button that issues the request, driven by htmx, of course, and then another button that will send an <code>htmx:abort</code> event to the first one.</p> <p>Here is what the code might look like:</p> <figure> <div class="sourceCode" id="cb114"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="dt"><</span><span class="kw">button</span><span class="ot"> id</span><span class="op">=</span><span class="st">"contacts-btn"</span><span class="ot"> hx-get</span><span class="op">=</span><span class="st">"/contacts"</span><span class="ot"> hx-target</span><span class="op">=</span><span class="st">"body"</span><span class="dt">></span> <span class="er"><</span>1></span> <span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a> Get Contacts</span> <span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="dt"></</span><span class="kw">button</span><span class="dt">></span></span> <span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="dt"><</span><span class="kw">button</span></span> <span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="ot"> onclick</span><span class="op">=</span><span class="st">"</span></span> <span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="st"> document.getElementById('contacts-btn')</span></span> <span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="st"> .dispatchEvent(new Event('htmx:abort')) </span><span class="er"><</span><span class="st">2></span></span> <span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="st"> "</span><span class="dt">></span></span> <span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a> Cancel</span> <span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="dt"></</span><span class="kw">button</span><span class="dt">></span></span></code></pre></div> <figcaption><p>A button with an abort</p></figcaption> </figure> <ol> <li><p>A normal htmx-driven <code>GET</code> request to <code>/contacts</code></p></li> <li><p>JavaScript to look up the button and send it an <code>htmx:abort</code> event</p></li> </ol> <p>So now, if a user clicks on the “Get Contacts” button and the request takes a while, they can click on the “Cancel” button and end the request. Of course, in a more sophisticated user interface, you may want to disable the “Cancel” button unless an HTTP request is in flight, but that would be a pain to implement in pure JavaScript.</p> <p>Thankfully this isn’t too bad to implement in hyperscript, so let’s take a look at what that would look like:</p> <figure> <div class="sourceCode" id="cb115"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="dt"><</span><span class="kw">button</span><span class="ot"> id</span><span class="op">=</span><span class="st">"contacts-btn"</span><span class="ot"> hx-get</span><span class="op">=</span><span class="st">"/contacts"</span><span class="ot"> hx-target</span><span class="op">=</span><span class="st">"body"</span><span class="dt">></span></span> <span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a> Get Contacts</span> <span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="dt"></</span><span class="kw">button</span><span class="dt">></span></span> <span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="dt"><</span><span class="kw">button</span></span> <span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="ot"> _</span><span class="op">=</span><span class="st">"on click send htmx:abort to #contacts-btn</span></span> <span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="st"> on htmx:beforeRequest from #contacts-btn remove @disabled from me</span></span> <span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="st"> on htmx:afterRequest from #contacts-btn add @disabled to me"</span><span class="dt">></span></span> <span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a> Cancel</span> <span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="dt"></</span><span class="kw">button</span><span class="dt">></span></span></code></pre></div> <figcaption><p>A hyperscript-Powered Button With An Abort</p></figcaption> </figure> <p>Now we have a “Cancel” button that is enabled only when a request from the <code>contacts-btn</code> button is in flight. And we are taking advantage of htmx-generated and handled events, as well as the event-friendly syntax of hyperscript, to make it happen. Slick!</p> </section> <section id="id__server_generated_events" class="level4"> <h4>Server Generated Events</h4> <p>We are going to talk more about the various ways that htmx enhances regular HTTP requests and responses in the next section, but, since it involves events, we are going to discuss one HTTP Response header that htmx supports: <code>HX-Trigger</code>. We have discussed before how HTTP requests and responses support <em>headers</em>, name-value pairs that contain metadata about a given request or response. We took advantage of the <code>HX-Trigger</code> request header, which includes the id of the element that triggered a given request.</p> <p>In addition to this <em>request header</em>, htmx also supports a <em>response header</em> also named <code>HX-Trigger</code>. This response header allows you to <em>trigger an event</em> on the element that submitted an AJAX request. This turns out to be a powerful way to coordinate elements in the DOM in a decoupled manner.</p> <p>To see how this might work, let’s consider the following situation: we have a button that grabs new contacts from some remote system on the server. We will ignore the details of the server-side implementation, but we know that if we issue a <code>POST</code> to the <code>/sync</code> path, it will trigger a synchronization with the system.</p> <p>Now, this synchronization may or may not result in new contacts being created. In the case where new contacts <em>are</em> created, we want to refresh our contacts table. In the case where no contacts are created, we don’t want to refresh the table.</p> <p>To implement this we could conditionally add an <code>HX-Trigger</code> response header with the value <code>contacts-updated</code>:</p> <figure> <div class="sourceCode" id="cb116"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">'/sync'</span>, methods<span class="op">=</span>[<span class="st">"POST"</span>])</span> <span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sync_with_server():</span> <span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a> contacts_updated <span class="op">=</span> RemoteServer.sync() <span class="op"><</span><span class="dv">1</span><span class="op">></span></span> <span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a> resp <span class="op">=</span> make_response(render_template(<span class="st">'sync.html'</span>))</span> <span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> contacts_updated <span class="op"><</span><span class="dv">2</span><span class="op">></span></span> <span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a> resp.headers[<span class="st">'HX-Trigger'</span>] <span class="op">=</span> <span class="st">'contacts-updated'</span></span> <span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> resp</span></code></pre></div> <figcaption><p>Conditionally Triggering a <code>contacts-updated</code> event</p></figcaption> </figure> <ol> <li><p>A call to the remote system that synchronized our contact database with it</p></li> <li><p>If any contacts were updated we conditionally trigger the <code>contacts-updated</code> event on the client</p></li> </ol> <p>This value would trigger the <code>contacts-updated</code> event on the button that made the AJAX request to <code>/sync</code>. We can then take advantage of the <code>from:</code> modifier of the <code>hx-trigger</code> attribute to listen for that event. With this pattern we can effectively trigger htmx requests from the server side.</p> <p>Here is what the client-side code might look like:</p> <figure> <div class="sourceCode" id="cb117"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="dt"><</span><span class="kw">button</span><span class="ot"> hx-post</span><span class="op">=</span><span class="st">"/integrations/1"</span><span class="dt">></span> <span class="er"><</span>1></span> <span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a> Pull Contacts From Integration</span> <span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="dt"></</span><span class="kw">button</span><span class="dt">></span></span> <span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span> <span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a> ...</span> <span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span> <span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="dt"><</span><span class="kw">table</span><span class="ot"> hx-get</span><span class="op">=</span><span class="st">"/contacts/table"</span></span> <span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="ot"> hx-trigger</span><span class="op">=</span><span class="st">"contacts-updated from:body"</span><span class="dt">></span> <span class="er"><</span>2></span> <span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a> ...</span> <span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="dt"></</span><span class="kw">table</span><span class="dt">></span></span></code></pre></div> <figcaption><p>The Contacts Table</p></figcaption> </figure> <ol> <li><p>The response to this request may conditionally trigger the <code>contacts-updated</code> event</p></li> <li><p>This table listens for the event and refreshes when it occurs</p></li> </ol> <p>The table listens for the <code>contacts-updated</code> event, and it does so on the <code>body</code> element. It listens on the <code>body</code> element since the event will bubble up from the button, and this allows us to not couple the button and table together: we can move the button and table around as we like and, via events, the behavior we want will continue to work fine. Additionally, we may want <em>other</em> elements or requests to trigger the <code>contacts-updated</code> event, so this provides a general mechanism for refreshing the contacts table in our application.</p> </section> </section> </x-turndown>`