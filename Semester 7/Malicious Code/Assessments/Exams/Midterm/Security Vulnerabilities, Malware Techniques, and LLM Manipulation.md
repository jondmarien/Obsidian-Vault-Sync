---
title: Security Vulnerabilities, Malware Techniques, and LLM Manipulation
author:
  - Jon Marien
created: 2025-02-12
published: 2025-02-12
tags:
  - classes
  - INFO43921
---

| Title                                                              | Author                       | Created           | Published         | Tags                                               |
| ------------------------------------------------------------------ | ---------------------------- | ----------------- | ----------------- | -------------------------------------------------- |
| Security Vulnerabilities, Malware Techniques, and LLM Manipulation | <ul><li>Jon Marien</li></ul> | February 12, 2025 | February 12, 2025 | [[#classes\|#classes]], [[#INFO43921\|#INFO43921]] |

---

# **Midterm Study Guide - INFO43921**

### **I.  LLMs and Prompt Injection**
*   **Prompt Injection:** This is a technique where an attacker manipulates the input to a Large Language Model (LLM) to make it perform unintended actions. This can include revealing sensitive data, bypassing security safeguards, or executing malicious code.
    *   **Direct prompt injection** uses an override command to bypass internal rules. Example: "Ignore all previous instructions".
    *   **Indirect prompt injection** uses other means such as malicious instructions hidden in web pages or images.
*   **OWASP Top 10 LLMs:** A community-driven effort to address security issues specific to LLMs.
*   **Types of vulnerabilities:**
    *   **Sensitive Information Disclosure**: LLMs can unintentionally reveal sensitive data such as API keys, personal data, or internal system prompts.
    *   **Supply Chain Risks:** Vulnerabilities can originate from third-party dependencies like data pipelines, models and plugins.
    *  **Data and Model Poisoning**: Malicious data can manipulate LLM training or inference leading to biased or harmful outputs.
    *   **Improper Output Handling:** LLMs can generate harmful or inappropriate content if output is not sanitized.
    *   **Excessive Agency:** Giving LLMs too many permissions can lead to unintended actions like data exfiltration.
    *   **System Prompt Leakage:** Attackers can extract the hidden system prompts that guide an LLM's behavior.
    *   **Vector & Embedding Weaknesses**: Vulnerabilities in embedding methods can be exploited through adversarial inputs.
    *   **Misinformation**: LLMs can generate false or misleading information.
    *   **Unbounded Consumption**: Attackers can cause excessive resource consumption, leading to high costs or denial-of-service.

### **II. Malware and Exploits**
*   **Malware** is malicious software designed to harm or exploit computer systems, whereas **exploit** is a piece of code that takes advantage of a vulnerability to gain control of the vulnerable system.
*   **Malware Types:**
    *   **Spyware/Infostealer**: Steals sensitive data.
    *   **Keylogger**: Records keystrokes.
    *   **Botnet**: Network of infected machines controlled by an attacker.
    *   **Adware**: Displays unwanted ads.
    *   **Rootkit**: Conceals malware activity by modifying system functions.
    *  **Banking Malware**: Intercepts and modifies browser communications to capture financial information.
    *   **Ransomware**: Holds data hostage for ransom.
    *   **Cryptominer**: Uses system resources to mine cryptocurrency.
    *   **Downloader**: Downloads other malware.
    *   **Spammer**: Sends out spam emails.
*   **Malware Analysis Goals**: To understand what happened, locate infected machines, measure damage, and create signatures for intrusion detection.
*   **Malware Analysis Techniques:**
    *   **Static Analysis**: Examines malware without running it. Tools: VirusTotal, strings, IDA Pro.
    *   **Dynamic Analysis**: Runs malware in a safe environment to monitor its behavior. Tools: RegShot, Process Monitor, Process Hacker.
*   **Malware Lifecycle:** Development, Distribution, Infection, Post-Infection.
    *   **Self-Defense:** Malware uses techniques like cryptography, obfuscation, and polymorphism to avoid detection and analysis.

### **III. File Analysis Tools & Concepts**
*   **trid:** Command-line tool to identify file formats by analyzing their byte patterns, requires a dictionary of format types.
*  **notepad:** Can be used with a hex editor plugin to view files in hexadecimal format.
*   **YARA:** Not explicitly in the provided sources, but it is a tool for identifying and classifying malware samples by creating rules based on textual or binary patterns.
*   **strings:** Tool to extract readable strings from a file. Useful for finding C2 server info, URLs, etc..
*   **Packers/Cryptors**: Tools used to compress and/or obfuscate malware to avoid detection. They often include a loader/unpacking stub to restore the original code in memory.
    *   **UPX:** A specific packer that can be used to compress executable files.
*  **Entropy**: Measure of randomness of data within a file. Higher entropy suggests compression or encryption.
*   **MZ**: Magic bytes at the beginning of a Windows DOS executable file.
*  **File Extensions**:  Used to associate a file with a specific application but can be faked by malware authors.
*   **Magic Bytes**: Specific characters at the beginning of a file that indicate its type.

### **IV.  DLLs and Code Injection**
*   **DLL (Dynamic-Link Library):** A file containing code and data that can be shared by multiple programs. DLL files have a .dll extension and utilize the PE file format.
    *   DLLs cannot be run independently and require an EXE file to execute them.
    *   DLLs contain APIs (Application Programming Interfaces).
    *   The **Import Address Table (IAT)** in a PE file contains the addresses of APIs used by that file.
*   **DLL Injection:** A technique where a malicious DLL is loaded into a legitimate process.
    *   **Classical DLL Injection**: Uses `LoadLibrary()` to load a DLL from the disk into a process.
    *   **Reflective DLL Injection**: The injector acts as the Windows loader and loads the DLL directly into memory without writing to disk or using `LoadLibrary()`.
*   **Code Injection:** Process of injecting malicious code into a running process.
    *   **Steps:**
        1.  **Locate the target process**
        2.  **Inject the code** into the target by allocating memory and writing code.
        3.  **Execute the injected code**.
    *  **Common APIs:** `OpenProcess`, `VirtualAllocEx`, `WriteProcessMemory`, `CreateRemoteThread`, `QueueUserAPC`, `GetThreadContext`, `SetThreadContext`, `ResumeThread`.
*   **Shellcode:** Raw machine code without a PE header, injected directly into a process.

### **V. Persistence Mechanisms**
*   **Persistence:** Techniques malware uses to ensure it runs even after reboots.
*   **Common Mechanisms:**
    *   **Startup Folders**: Malware places copies of itself in startup folders.
    *   **Registry Run Keys**: Malware adds entries to registry keys so they launch at startup.
    *   **Windows Services**: Malware registers itself as a service to start automatically.
    *   **File Infection**: Malware adds malicious code to other executable files.
    *   **DLL Hijacking**: Malware replaces a legitimate DLL with a malicious one.
    *  **Winlogon**: Malware modifies the shell or userinit keys.
    *   **Task Scheduler**: Malware creates scheduled tasks to run at specific times.
    *   **Image File Execution Options (IFEO)**: Malware sets itself as a debugger for other programs.
    * **SilentProcessExit**: Configures programs to be launched when another process exits.
*   **Tools for Analysis:**
    *   **Autoruns:** Lists all programs using autostart persistence mechanisms.
    *  **Process Monitor (ProcMon)**: Monitors file system, registry, and process activity.

### **VI. APC Queue and Process Hollowing**
*   **APC (Asynchronous Procedure Call) Queue:** A queue associated with each thread in a process used to execute code asynchronously.  Malware can use `QueueUserAPC()` to inject and execute code in a thread's APC queue.
*   **Process Hollowing:** A technique where malware starts a legitimate process in a suspended state, replaces the legitimate code with its own, and then resumes the process.
    *   Steps include starting a process in suspended mode, creating a section and view to map the malware's code into the hollowed process, and resuming the process.
*   **Key APIs**: `NtCreateSection`, `NtMapViewOfSection`, `ResumeThread`.

## **Example Midterm**
**Instructions:** *This exam has multiple choice, true/false, multiple selection, and short answer questions.*
### **Part I: Multiple Choice (1 point each)**
1.  Which of the following best describes prompt injection?
    a) A method of compressing malware
    b) A technique to manipulate LLM behavior
    c) A type of network attack
    d) A way to encrypt data

2.  Which file format begins with the magic bytes "MZ"?
    a) PNG
    b) ZIP
    c) Windows DOS executable
    d) DLL

3. Which of the following is NOT a persistence mechanism?
    a) Startup Folders
    b) Registry Run Keys
    c) Process Hollowing
    d) Windows Services

### **Part II: True/False (1 point each)**
1. True or False: Static analysis involves running malware in a controlled environment.
2. True or False:  A DLL file can be run independently like a .exe file
3. True or False:  Higher entropy in a file usually means the file is uncompressed

### **Part III: Multiple Selection (2 points each)**
1. Which of the following are common goals of malware analysis? (Select all that apply)
    a) Locate all infected machines
    b) Measure and contain damage
    c) Increase system performance
    d) Find signatures for intrusion detection systems

2.  Which of the following are steps in code injection? (Select all that apply)
    a) Locate the target process
    b) Allocate memory in the target process
    c) Encrypt the target process
    d) Execute injected code

3. Which of the following API calls might be used for code injection?
     a) `CreateFile`
     b) `VirtualAllocEx`
     c) `WriteProcessMemory`
     d) `RegCreateKey`

### **Part IV: Short Answer (5 points each)**
1.  Explain the difference between malware and an exploit.

2.  What is the purpose of a packer, and how can it affect the analysis of malware?

3.  Explain the four steps of code injection.

4.  Describe the function of the APC queue and how it is used in malware.

5.  Given the following screenshot of Process Hacker, determine the physical address where the DLL (sample-4-2.dll) is located. (Assume the image base is the starting address.)
   *(Provide a hypothetical screenshot showing a DLL loaded at a specific address such as 0x10000000 with an offset)*

### **Part V: Analysis Questions (10 points each)**
1.  **Scenario:** You have a file that appears to be a PDF, but you suspect it might be malicious.  List the steps and tools you would use for static analysis to determine if it’s a malicious file.

2. **Persistence Analysis:** You find the following registry key entry: `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\MyMalware: C:\malware\malware.exe`. Explain what kind of persistence mechanism this is, how it works, and how you would use analysis tools like Autoruns and ProcMon to confirm this.

3. **Process Hollowing:** Explain what process hollowing is, and provide a real world scenario how this technique may be used by a malicious actor to conceal the presence of malware.